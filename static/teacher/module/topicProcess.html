<!doctype html>

<meta charset="utf-8">
<title>Process</title>
<script src="/js/d3.v4.min.js" charset="utf-8"></script>
<script src="/js/dagre-d3.min.js"></script>
<script src="/js/jquery.min.js"></script>
<script src="/js/config/server.js"></script>
<script src="/js/common/login.js"></script>

<style id="css">
    /* This sets the color for "TK" nodes to a light blue green. */
    g.type-current > rect {
        fill: #1E9FFF;
    }
    g.type-success > rect {
        fill: green;
    }
    g.type-fail > rect {
        fill: red;
    }

    text {
        font-weight: 300;
        font-family: "Helvetica Neue", Helvetica, Arial, sans-serf;
        font-size: 14px;
    }

    .node rect {
        stroke: #999;
        fill: #fff;
        stroke-width: 1.5px;
    }

    .edgePath path {
        stroke: #333;
        stroke-width: 1.5px;
    }
</style>

<svg id="svg-canvas" width=500 height=500></svg>

<script >
  var topicId = sessionStorage.getItem('dataFlowTopicId');
  var dataFlow = {
    0: '起点',
    1: '提交审核',
    2: '审核通过',
    3: '审核未过',
    4: '课题已被选',
    5: '暂无学生选题',
    6: '一辩未过',
    7: ' 一辩通过',
    8: '二辩未过 ',
    9: '二辩通过',
    10: '三辩未过 ',
    11: '三辩通过',
    20: '答辩结束'
  };
  // Create the input graph
  var g = new dagreD3.graphlib.Graph()
    .setGraph({})
    .setDefaultEdgeLabel(function() { return {}; });

    for (var i = 0; i < 12; i++) {
      g.setNode(i, {
        label:dataFlow[i],
        class: "type-no",
        id: "status"+i
      });
    }
    // g.setNode(20, {
    //   label: dataFlow[20],
    //   class:'type-no',
    //   id: 'status20'
    // });
  g.nodes().forEach(function(v) {
    var node = g.node(v);
    // Round the corners of the nodes
    node.rx = node.ry = 5;
  });

  // Set up edges, no special attributes.

  g.setEdge(0, 1);
  g.setEdge(1, 2);
  g.setEdge(1, 3);
  g.setEdge(2, 4);
  g.setEdge(2, 5);
  g.setEdge(3, 1);
  g.setEdge(4, 6);
  g.setEdge(4, 7);
  g.setEdge(6, 8);
  g.setEdge(6, 9);
  g.setEdge(8, 10);
  g.setEdge(8, 11);

  // g.setEdge(7, 20);
  // g.setEdge(9, 20);
  // g.setEdge(11, 20);

  // Create the renderer
  var render = new dagreD3.render();

  // Set up an SVG group so that we can translate the final graph.
  var svg = d3.select("svg"),
    svgGroup = svg.append("g");

  // Run the renderer. This is what draws the final graph.
  render(d3.select("svg g"), g);

  // Center the graph
  var xCenterOffset = (svg.attr("width") - g.graph().width) / 2;
  svgGroup.attr("transform", "translate(" + xCenterOffset + ", 20)");
  svg.attr("height", g.graph().height + 40);

</script>
<script>
  selectSuccess('0');
  handlerGet('/rest/topic/get/' + topicId, 'teacher', function (data) {
    if (data.code === '0') {
      console.log(data.data);
      var status = parseInt(data.data.status);
      if (status === 0) {
        return 0;
      }
      if (status >= 1) {
        selectSuccess('1');
      }
      if(status>2 && status%2===1){
        if(status < 7){
          selectFail(status);
        }else{
          selectPass(status);
        }

      }
      if (status === 2 || status > 3) {
        selectSuccess(2);
      }
      if (status === 4 || status > 5) {
        selectSuccess(4);
      }
      if (status === 6 || status > 7) {
        selectSuccess(6);
      }
      if (status === 8 || status > 9) {
        selectSuccess( 8);
      }
      if (status === 10) {
        selectFail(10);
      }
    }
  });

  function selectSuccess(name) {
    document.getElementById("status" + name).setAttribute('class', 'type-current');
  }
  function selectFail(name) {
    document.getElementById("status" + name).setAttribute('class', 'type-fail');
  }
  function selectPass(name) {
    document.getElementById("status" + name).setAttribute('class', 'type-success');
  }
</script>
