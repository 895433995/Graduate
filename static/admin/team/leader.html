<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Title</title>
    <link rel="stylesheet" href="/layui/css/layui.css"/>
    <link href="/layui/css/modules/layer/default/layer.css" rel="stylesheet"/>
    <link rel="stylesheet" href="/css/index.css"/>
</head>
<script src="/js/jquery.min.js"></script>
<script src="/js/config/server.js"></script>
<script src="/js/common/login.js"></script>
<script src="/js/common/upload.js"></script>
<script src="/layui/layui.all.js"></script>
<style>
    .main {
        text-align: right;
    }

    label {
        text-align: left;
        float: left;
    }
</style>
<body>

<div id="Tips" class="main">
    <label for="collegeId">学院</label>
    <select id="collegeId" name="collegeId" onchange="showMajor()">
        <option value="DEFAULT"></option>
    </select>
    <br>
    <label for="majorId">专业</label>
    <select id="majorId" name="majorId" onchange="showTeacher()">
        <option value="DEFAULT"></option>
    </select>
    <br/>
    <label for="leaderId">负责人</label>
    <select id="leaderId" name="leaderId" >
        <option value="DEFAULT"></option>
    </select>
    <br>
    <br>
    <br>
</div>
<button class="layui-btn layui-btn-normal" style="margin-left: 39%;" onclick="submit()">提交</button>

<script>
  var teamId = sessionStorage.getItem('editTeamId');
  var editCollege = null;
  var editMajor = null;
  var editLeader = null;

  handlerGetSync('/rest/team/' + teamId, 'admin', function (data) {
    console.log('收到'+JSON.stringify(data));
    editMajor = data.data.majorId;
    editLeader = data.data.leaderId;

    sessionStorage.setItem('editMajor', editMajor);
    $("#name").val(data.data.name);
    handlerGetSync('/rest/major/' + editMajor, 'admin', function (data) {
      sessionStorage.setItem('editCollege', data.data.collegeId);
    });
    sessionStorage.setItem('editLeader', editLeader);
  });

  handlerGet('/rest/college/listTotal', 'admin', function (data) {
    data.data.forEach(function (item) {
      if (sessionStorage.getItem('editCollege') === item.collegeId) {
        $("#collegeId").append('<option value="' + item.collegeId + '" selected>' + item.name + '</option>');
        handlerGet('/rest/major/listTotalByCollege/' + item.collegeId, 'admin', function (data) {
          $("#majorId").html('<option value="DEFAULT"></option>');
          data.data.forEach(function (item) {
            if(sessionStorage.getItem('editMajor') === item.majorId){
              $("#majorId").append('<option value="' + item.majorId + '" selected>' + item.name + '</option>');
            }else{
              $("#majorId").append('<option value="' + item.majorId + '">' + item.name + '</option>');
            }

          });
        });
      }else{
        $("#collegeId").append('<option value="' + item.collegeId + '">' + item.name + '</option>');
      }
    });
  }, function (data) {
    layer.msg('加载学院失败，请检查网络' + data.responseText)
  });

  // 根据学院加载专业
  function showMajor() {
    collegeId = $("#collegeId").val();
    handlerGet('/rest/major/listTotalByCollege/' + collegeId, 'admin', function (data) {
      $("#majorId").html('<option value="DEFAULT"></option>');
      data.data.forEach(function (item) {
        $("#majorId").append('<option value="' + item.majorId + '">' + item.name + '</option>');
      });
    });
  }
  function showTeacher() {
    majorId = $("#majorId").val();
    handlerGet('/rest/teacher/listTotalByMajor/'+majorId, 'admin', function (data) {
      $("#leaderId").html('<option value="DEFAULT"></option>');
      data.data.forEach(function (item) {
        $("#leaderId").append('<option value="' + item.teacherId + '">' + item.username + '</option>');
      });
    }, function (data) {

    })
  }
  function submit() {
    var editId = sessionStorage.getItem("editTeamId");
    var collegeId = $("#collegeId").val();
    var majorId = $("#majorId").val();
    var leaderId = $("#leaderId").val();

    // console.log(name , year, collegeId, majorId, judgeId);
    var send = {
      teamId: editId,
      majorId:majorId,
      leaderId: leaderId
    };
    handlerPost('/rest/team/leader', 'admin', JSON.stringify(send), function (data) {
      layer.msg('委派成功');
      sessionStorage.removeItem('editJudge');
      sessionStorage.removeItem('editMajor');
      sessionStorage.removeItem('editCollege');
    }, function (data) {
      console.log('保存失败')
    })
  }

</script>
</body>
</html>